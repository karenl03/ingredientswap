<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ingredient Swap</title>
<link rel="icon" href="is-logo.png">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Abril+Fatface&display=swap">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto+Mono&display=swap">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,1,0" /><style>

    .container-wrapper {
            height: 100vh; /* Make the container take up the full viewport height */
            overflow-y: scroll; /* Enable vertical scrolling */
        }

    .material-symbols-outlined {
        font-size: 50px;
        color: #B4D4CA;
        margin-top: 10px;
    }

    body {
        font-family: 'Abril Fatface';
        font-weight: normal;
        width: 100%;
        margin: 0;
        padding: 0;
        background-color: #ffffff;
        display: flex;
        flex-direction: column;
    }

    h1 {
        font-family: 'Abril Fatface';
        padding: 0;
        margin: 0;
        order: 1;
    }

    h2 {
        font-family: 'Abril Fatface';
        padding: 0;
        margin: 0;
        font-size: 18px;
        order: 2;
    }

    .container {
        flex: 1;
        max-width: 90%;
        margin: 0 auto;
        padding: 10px;
        background-color: #FFF;
        border-radius: 10px;
        margin-top: 10px;
        position: relative;
        text-align: center;
    }

    .title {
        font-size: 18px;
        font-weight: bold;
        color: #F17D98;
        text-align: center;
        margin-top: 5px;
    }

    .text-title {
        font-size: 15px;
        font-weight: bold;
        color: #ffffff;
        text-align: left;
    }

    .text-box {
        font-size: 15px;
        font-family: 'Roboto', italic;
        font-weight: normal;
        color: #000000;
        text-align: left;
        margin-top: px;
    }

    header {
        background-color: #B4D4CA;
        color: #fff;
        height: 68px;
        text-align: center;
        padding: 10px 0;
    }

    footer {
        position: fixed;
        left: 0;
        bottom: 0;
        width: 100%;
        background-color: #fff;
        color: #fff;
        height: 50px;
        text-align: center;
        padding: 10px 0;
    }

    footer-top {
        position: fixed;
        bottom: 50px; /* Adjust to fit the size of the footer */
        width: 100%;
        background-color: #B4D4CA;
        height: 5px; /* Adjust the height of the rectangle */
        text-align: center;
        padding: 10px 0;
    }

    .footer-icons {
        display: flex;
        justify-content: space-around;
    }

    .header-icons {
        display: flex;
        justify-content: space-between;
        padding: 0 20px; 
    }

    .header-text {
        display: flex;
        flex-direction: column;
    }

    .ingredients-title {
        font-family: 'Abril Fatface';
        font-weight: normal;
        color: #000000;
        text-decoration: underline;
        text-align: left;
        margin-top: 5px;
        margin-left: 10px;
    }

    .nutrition-title {
        font-size: 12px;
        font-family: 'Abril Fatface';
        font-weight: normal;
        color: #000000;
        text-decoration: underline;
        text-align: left;
        margin-top: 5px;
        margin-left: 10px;
    }

    .nutrition-text {
        font-size: 20px;
        font-family: 'Roboto Mono', normal;
        font-weight: normal;
        color: #000000;
        text-align: left;
        margin-left: 20px;
        text-decoration: none;
        line-height: 0.75;
    }

    .save-button-container {
        bottom: 100px;
        right: 28px;
        margin-left: 269px;
        margin-top: 10px;
        margin-bottom: 100px;
    }

    .save-button {
        font-family: 'Abril Fatface';
        font-size: 25px;
        background-color: #F17D98;
        color: #fff;
        border: none;
        padding: 10px 20px;
        cursor: pointer;
    }

    .button:hover {
        background-color: #d84f96;
    }

    .container img {
        display: block;
        margin: 0 auto;
        border: 4px solid #B4D4CA;
    }
    .todo-list {
        list-style-type: none;
        padding: 0;
    }

    .todo-item {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
    }

    .task {
        font-size: 20px;
        font-family: 'Roboto Mono', normal;
        font-weight: normal;
    }

    .button {
        font-size: 16px;
        padding: 5px 10px;
        cursor: pointer;
        background-color: rgb(255, 255, 255);
        width: 40px; /* Set a fixed width */
        height: 30px; /* Set a fixed height */
        margin-left: 15px;
    }

    .button:hover {
        background-color: rgb(255, 255, 255);
    }

    .arrow.x-mark::before {
        content: "X";
    }

    .button-container {
        display: flex;
        align-items: center;
    }

    .number {
        margin-right: 10px;
        font-size: 22px;
        font-weight: bold;
        color: #F17D98;
        margin-left: 8px;
    }

    .modify-button-container {
        display: flex;
        align-items: center;
        margin: auto;
    }

    .sugar-button {
        font-family: 'Abril Fatface';
        font-size: 15px;
        background-color: #fff;
        color: #000;
        border: 2px solid #B4D4CA;
        padding: 10px 10px;
        margin-bottom: 5px;
        margin-left: 15px;
        margin-right: 15px;
        cursor: pointer;
    }

    .sugar-button.clicked {
    background-color: #B4D4CA;
    }

    .protein-button {
        font-family: 'Abril Fatface';
        font-size: 15px;
        background-color: #fff;
        color: #000;
        border: 2px solid #B4D4CA;
        padding: 10px 10px;
        margin-bottom: 5px;
        margin-left: 15px;
        margin-right: 15px;
        cursor: pointer;
    }

    .protein-button.clicked {
        background-color: #B4D4CA;
    }

    .fat-button {
        font-family: 'Abril Fatface';
        font-size: 15px;
        background-color: #fff;
        color: #000;
        border: 2px solid #B4D4CA;
        padding: 10px 10px;
        margin-bottom: 5px;
        margin-left: 15px;
        margin-right: 15px;
        cursor: pointer;
    }

    .fat-button.clicked {
        background-color: #B4D4CA;
    }

</style>
</head>
<body>

<header>
    <img src="is-logo.png" alt="Logo" height="68px">
</header>

<div class="container-wrapper">

<div class="title">
    <div class="header-icons">
        <a href="SavedRecipe.html">
            <span class="material-symbols-outlined" style="font-size: 30px;">arrow_back_ios</span>
        </a>
        <div class = "header-text">
            <h1>Edit Recipe</h1>
            <h2>Click to remove an ingredient</h2>
        </div>
        <a href="#" onclick="navigateToInfo()">
            <span class="material-symbols-outlined" style="font-size: 30px;">info</span>
        </a>
    </div>
</div>

<script>
    function navigateToInfo() {
        // Navigate to the new page
        window.location.href = "Information.html";
    }
</script>

<div class="ingredients-title">
    <h2 style="margin-bottom: 0;">Ingredients</h2>
</div>

<ul class="todo-list" id="recipeList">
    <!-- List items will be generated dynamically -->
</ul>

<div class="nutrition-title">
    <h1>Nutrition</h1>
</div>

    <div class ="nutrition-text">
        <p>10g Fat</p>
        <p>5g Protein</p>
        <p>15g Sugar</p>
        <p>200 Calories</p>
    </div>


<div class="modify-button-container">
    <button class="sugar-button" onclick="modifySugar(this)">Low Sugar</button>
    <button class="protein-button" onclick="modifyProtein(this)">High Protein</button>
    <button class="fat-button" onclick="modifyFat(this)">Low Fat</button>
</div>

<div class="save-button-container">
    <button class="save-button" onclick="saveAndNavigate()">Save</button>
</div>

</div>

<script>
     // Define variables for storing image states
var milkImage = false;
var eggImage = false;
var glutenImage = false;
var peanutImage = false;
var veganImage = false;

// Retrieve selected allergens from local storage
const savedAllergens = localStorage.getItem('selectedAllergens');
const recipe = JSON.parse(localStorage.getItem('selectedRecipe'));

// Define replacement rules based on allergens
const replacementRules = {
    "Milk": {
        "cup Milk": "cup Almond Milk",
        "cup Yogurt": "cup Almond Yogurt",
        "cups Milk": "cups Almond Milk",
        "cups Yogurt": "cups Almond Yogurt",
        "cup Butter": "cup Oil",
        "cups Butter": "cups Oil",
        // Add more rules specific to milk
    },
    "Eggs": {
        "Eggs": "Flax Eggs",
        "Egg Whites": "Flax Egg Whites",
        // Add more rules specific to eggs
    },
    "Peanuts": {
        "cup Peanuts": "cup Almonds",
        "cup Peanut Butter": "cup Almond Butter",
        "cups Peanut Butter": "cups Almond Butter",
        // Add more rules specific to peanuts
    },
    "Tree Nuts": {
        "cup Almonds": "cup Pumpkin Seeds",
        "cup Almond Butter": "cup Sunflower Butter",
        "cups Almond Butter": "cups Sunflower Butter",
        // Add more rules specific to tree nuts
    },
    "Gluten": {
        "cup Flour": "cup Oat Flour",
        "cups Flour": "cups Oat Flour",
    },
    "Vegan": {
        "cup Milk": "cup Almond Milk",
        "cup Yogurt": "cup Almond Yogurt",
        "cups Milk": "cups Almond Milk",
        "cups Yogurt": "cups Almond Yogurt",
        "cup Butter": "cup Oil",
        "cups Butter": "cups Oil",
        "Eggs": "Flax Eggs",
        "Egg Whites": "Flax Egg Whites",
    },
    // Add more allergens and their replacement rules as needed
};

// If there are saved allergens, parse the JSON string and modify ingredients
if (savedAllergens) {
    const selectedAllergens = JSON.parse(savedAllergens);

    // Iterate over each allergen
    selectedAllergens.forEach(allergen => {
        // Modify ingredients based on allergens
        recipe.ingredients.forEach(ingredient => {
            // Check if ingredient needs to be replaced based on allergen
            if (replacementRules[allergen] && replacementRules[allergen][ingredient.task]) {
                ingredient.task = replacementRules[allergen][ingredient.task]; // Update the ingredient task
                ingredient.modified = true;
            }
        });
    });
}

    // Function to toggle the appearance of the button and mark ingredient for removal
    function toggleState(button) {
        if (button.innerText === '') {
            button.innerText = 'X'; // Display X symbol
        } else {
            button.innerText = ''; // Remove X symbol
        }
    }

// Log the modified recipe with replaced ingredients
console.log("Modified Recipe:", recipe);
</script>

<script>
// Function to generate list items from recipe object
function generateRecipeList(recipe) {
    const recipeList = document.getElementById('recipeList');

    // Clear existing list items
    recipeList.innerHTML = '';

    // Generate list items for each ingredient
    recipe.ingredients.forEach(ingredient => {
        const listItem = document.createElement('li');
        listItem.className = 'todo-item';

        const buttonContainer = document.createElement('div');
        buttonContainer.className = 'button-container';

        const button = document.createElement('button');
        button.className = 'button';
        button.setAttribute('onclick', 'toggleState(this)');

        const spanNumber = document.createElement('span');
        spanNumber.className = 'number';
        spanNumber.textContent = ingredient.number;

        const spanTask = document.createElement('span');
        spanTask.className = 'task';
        spanTask.textContent = ingredient.task;

        // Check if ingredient has been modified, and underline it if necessary
        if (ingredient.modified) {
            spanTask.style.textDecoration = 'underline';
        }

        buttonContainer.appendChild(button);
        buttonContainer.appendChild(spanNumber);
        listItem.appendChild(buttonContainer);
        listItem.appendChild(spanTask);

        recipeList.appendChild(listItem);
    });
}

// Call the function to generate the recipe list
generateRecipeList(recipe);
</script>


<script>
function modifySugar(button) {
    button.classList.toggle('clicked');
    const isClicked = button.classList.contains('clicked');
    localStorage.setItem('sugarClicked', isClicked);

    // Define replacement rules for sugar-related ingredients
    const replacementRulesSugar = {
        "cup White Sugar": "cup Honey",
        "cup Brown Sugar": "cup Maple Syrup",
        "cups White Sugar": "cups Honey",
        "cups Brown Sugar": "cups Maple Syrup"
    };

    // Define replacement rules for sugar-related ingredients
    const replacementRulesSugarDone = {
        "cup Honey": "cup White Sugar",
        "cup Maple Syrup": "cup Brown Sugar",
        "cups Honey": "cups White Sugar",
        "cups Maple Syrup": "cups Brown Sugar"
    };

    // Retrieve the recipe from localStorage
    const recipe = JSON.parse(localStorage.getItem('selectedRecipe'));

    // If the button is clicked, apply the replacement rules
    if (isClicked) {
        recipe.ingredients.forEach(ingredient => {
            if (replacementRulesSugar[ingredient.task]) {
                ingredient.task = replacementRulesSugar[ingredient.task];
            }
        });
    } else {
        // If the button is not clicked, revert to the original recipe
        recipe.ingredients.forEach(ingredient => {
            if (replacementRulesSugarDone[ingredient.task]) {
                ingredient.task = replacementRulesSugarDone[ingredient.task];            }
        });
    }

    // Save the modified recipe back to localStorage
    localStorage.setItem('selectedRecipe', JSON.stringify(recipe));

    // Regenerate the recipe list
    generateRecipeList(recipe);
}
</script>

<script>
function modifyProtein(button) {
    button.classList.toggle('clicked');
    const isClicked = button.classList.contains('clicked');
    localStorage.setItem('proteinClicked', isClicked);

    // Define replacement rules for sugar-related ingredients
    const replacementRulesProtein = {
        "Egg": "cup Egg White",
        "Eggs": "cup Egg Whites",
        "cup Flour": "cup Almond Flour",
        "cups Flour": "cups Almond Flour",
    };

    // Define replacement rules for sugar-related ingredients
    const replacementRulesProteinDone = {
        "cup Egg White": "Egg",
        "cup Egg Whites": "Eggs", 
        "cup Almond Flour": "cup Flour",
        "cups Almond Flour": "cups Flour",
    };

    // Retrieve the recipe from localStorage
    const recipe = JSON.parse(localStorage.getItem('selectedRecipe'));

    // If the button is clicked, apply the replacement rules
    if (isClicked) {
        recipe.ingredients.forEach(ingredient => {
            if (replacementRulesProtein[ingredient.task]) {
                ingredient.task = replacementRulesProtein[ingredient.task];
            }
        });
    } else {
        // If the button is not clicked, revert to the original recipe
        recipe.ingredients.forEach(ingredient => {
            if (replacementRulesProteinDone[ingredient.task]) {
                ingredient.task = replacementRulesProteinDone[ingredient.task];            }
        });
    }

    // Save the modified recipe back to localStorage
    localStorage.setItem('selectedRecipe', JSON.stringify(recipe));

    // Regenerate the recipe list
    generateRecipeList(recipe);
}
</script>

<script>
    function modifyFat(button) {
        button.classList.toggle('clicked');
    const isClicked = button.classList.contains('clicked');
    localStorage.setItem('proteinClicked', isClicked);

    // Define replacement rules for sugar-related ingredients
    const replacementRulesFat = {
        "cup Butter": "cup Apple Sauce",
        "cups Butter": "cups Apple Sauce",
        "cup Oil": "cup Apple Sauce",
        "cups Oil": "cups Apple Sauce",
    };

    // Define replacement rules for sugar-related ingredients
    const replacementRulesFatDone = {
        "cup Apple Sauce": "cup Butter",
        "cups Apple Sauce": "cups Butter", 
        "cup Apple Sauce": "cup Oil",
        "cups Apple Sauce": "cups Oil",
    };

    // Retrieve the recipe from localStorage
    const recipe = JSON.parse(localStorage.getItem('selectedRecipe'));

    // If the button is clicked, apply the replacement rules
    if (isClicked) {
        recipe.ingredients.forEach(ingredient => {
            if (replacementRulesFat[ingredient.task]) {
                ingredient.task = replacementRulesFat[ingredient.task];
            }
        });
    } else {
        // If the button is not clicked, revert to the original recipe
        recipe.ingredients.forEach(ingredient => {
            if (replacementRulesFatDone[ingredient.task]) {
                ingredient.task = replacementRulesFatDone[ingredient.task];            }
        });
    }

    // Save the modified recipe back to localStorage
    localStorage.setItem('selectedRecipe', JSON.stringify(recipe));

    // Regenerate the recipe list
    generateRecipeList(recipe);
}
</script>


<script>
    function saveAndNavigate() {
        // Get all the buttons with an 'X' symbol
        const buttonsWithX = document.querySelectorAll('.button');

        // Iterate over each button to check if it has the 'X' symbol
        buttonsWithX.forEach(button => {
            if (button.innerText === 'X') {
                // Get the parent list item
                const listItem = button.parentElement.parentElement;

                // Get the task text within the list item
                const taskText = listItem.querySelector('.task').textContent;

                // Find the index of the ingredient with the matching task in the recipe array
                const index = recipe.ingredients.findIndex(ingredient => ingredient.task === taskText);

                // Remove the ingredient from the recipe array
                recipe.ingredients.splice(index, 1);
            }
        });
        // Save the modified recipe to localStorage
        localStorage.setItem('modifiedRecipe', JSON.stringify(recipe));
        localStorage.setItem('milkImage', JSON.stringify(milkImage));
        localStorage.setItem('eggImage', JSON.stringify(eggImage));
        localStorage.setItem('glutenImage', JSON.stringify(glutenImage));
        localStorage.setItem('peanutImage', JSON.stringify(peanutImage));
        localStorage.setItem('veganImage', JSON.stringify(veganImage));
        window.location.href = "FinalRecipe.html";
    }
</script>

<footer-top></footer-top>
<footer>
    <div class="footer-icons">
        <span class="material-symbols-outlined">home</span>
        <span class="material-symbols-outlined">bookmark</span>
        <span class="material-symbols-outlined">person</span>
    </div>
</footer>

<!-- We used ChatGPT to help when we got stuck with Javascript for the buttons and finding the right CSS modifiers -->

</body>
</html>
